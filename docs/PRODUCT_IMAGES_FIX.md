# ุฅุตูุงุญ ูุดููุฉ ุฎูุท ุตูุฑ ุงูููุชุฌุงุช

## ๐ ุงูููุฎุต
ุชู ุฅุตูุงุญ ูุดููุฉ ุญุฑุฌุฉ ูุงูุช ุชุณุจุจ ุฎูุท ุตูุฑ ุงูููุชุฌุงุช ุนูุฏ ุฅูุดุงุก ูุชุฌุฑ ุฌุฏูุฏ. ุจุฏูุงู ูู ุฃู ูุญุตู ูู ููุชุฌ ุนูู ุตูุฑู ุงูุตุญูุญุ ูุงูุช ุงูุตูุฑ ุชุชู ุชูุฒูุนูุง ุจุดูู ุนุดูุงุฆู ุนูู ุงูููุชุฌุงุช.

---

## ๐ ุงููุดููุฉ ุงูุฃุตููุฉ

### ููู ูุงูุช ุชุญุฏุซ:
1. **ุฌูุน ุงููููุงุช ุงูุนุดูุงุฆู**: ุนูุฏ ุงุณุชูุจุงู ุงูุตูุฑ ุงููุฑููุนุฉ ูู ุนููู (ูุซู `productImage_0`, `productImage_1`, `productImage_2`)ุ ูุงูุช ุชูุฌูุน ูู array ูุงุญุฏ **ุฏูู ุงูุญูุงุธ ุนูู ุชุฑุชูุจ ุงูููุชุฌ**
   ```typescript
   // โ ุงูุทุฑููุฉ ุงููุฏููุฉ (ุฎุงุทุฆุฉ)
   if (fieldName.startsWith('productImage_')) {
     productFiles.push(...(files[fieldName] || []));
   }
   ```

2. **ูุทุน ุบูุฑ ุฏููู**: ุซู ุชููุทุน ูุฐู ุงููููุงุช ุจูุงุกู ุนูู `productsImageCounts`
   ```typescript
   // โ ุงูุทุฑููุฉ ุงููุฏููุฉ (ุฎุงุทุฆุฉ)
   let fileCursor = 0;
   parsedProducts = parsedProducts.map((product, idx) => {
     const count = productsImageCounts[idx] || 1;
     const filesForThisProduct = productFiles.slice(fileCursor, fileCursor + count);
     fileCursor += count; // โ ูุฏ ูููู ุงูุชุฑุชูุจ ุฎุงุทุฆุงู!
   });
   ```

3. **ุงููุชูุฌุฉ**: 
   - ููุชุฌ 1 ูุฏ ูุญุตู ุนูู ุตูุฑ ููุชุฌ 2
   - ููุชุฌ 2 ูุฏ ูุญุตู ุนูู ุตูุฑ ููุชุฌ 3
   - ูููุฐุง...

---

## โ ุงูุญู ุงููุทุจู

### 1. ุงุณุชุฎุฏุงู ุฎุฑูุทุฉ ุงูููุชุฌ (productFilesMap)
ุจุฏูุงู ูู array ูุงุญุฏุ ูุญุชูุธ ุจุฎุฑูุทุฉ (map) ุชุฑุจุท ุฑูู ุงูููุชุฌ ูุจุงุดุฑุฉ ุจุตูุฑู:

```typescript
// โ ุงูุทุฑููุฉ ุงูุฌุฏูุฏุฉ (ุตุญูุญุฉ)
const productFilesMap: Record<number, Express.Multer.File[]> = {};

if (files) {
  Object.keys(files).forEach(fieldName => {
    if (fieldName.startsWith('productImage_')) {
      // ุงุณุชุฎุฑุงุฌ ุฑูู ุงูููุชุฌ ูู ุงุณู ุงูุญูู (ูุซู productImage_0 โ 0)
      const productIndexMatch = fieldName.match(/productImage_(\d+)/);
      if (productIndexMatch) {
        const productIndex = parseInt(productIndexMatch[1], 10);
        if (!productFilesMap[productIndex]) {
          productFilesMap[productIndex] = [];
        }
        // ุญูุธ ุงูุตูุฑ ูู ุงูุฎุฑูุทุฉ ุงูุตุญูุญุฉ
        productFilesMap[productIndex].push(...(files[fieldName] || []));
      }
    }
  });
}
```

### 2. ุชุนููู ุงูุตูุฑ ุจูุงุกู ุนูู ุงูุฎุฑูุทุฉ
```typescript
// โ ุงูุทุฑููุฉ ุงูุฌุฏูุฏุฉ (ุตุญูุญุฉ)
parsedProducts = parsedProducts.map((product, idx) => {
  // ุงูุญุตูู ุนูู ุตูุฑ ูุฐุง ุงูููุชุฌ ูู ุงูุฎุฑูุทุฉ ูุจุงุดุฑุฉ
  const filesForThisProduct = productFilesMap[idx] || [];
  
  let images: string[] = [];
  if (filesForThisProduct.length > 0) {
    images = filesForThisProduct.map(f => `/assets/${storeSlug}/products/${f.filename}`);
  }
  
  return {
    ...product,
    images,
    // ...
  };
});
```

---

## ๐ฏ ุงูููุงุฆุฏ

| ุงูููุฒุฉ | ูุจู | ุจุนุฏ |
|-------|------|------|
| **ุฏูุฉ ุชุนููู ุงูุตูุฑ** | โ ุบูุฑ ููุซูู | โ 100% ุฏููู |
| **ุงูุญูุงุธ ุนูู ุงูุชุฑุชูุจ** | โ ูุฏ ูููู ุนุดูุงุฆูุงู | โ ูุฑุชุจุท ุจุฑูู ุงูููุชุฌ |
| **ูุนุงูุฌุฉ ุญููู ูุชุนุฏุฏุฉ** | โ ูุฎูุท ุจูููุง | โ ูุญุงูุธ ุนูู ูู ูููุง |
| **ุชูุณุนูุฉ ุงููุธุงู** | โ ูุตุนุจ ุฅุถุงูุฉ ููุฒุงุช | โ ุณูู ุงูุชูุณุน |

---

## ๐ ุงูุชูุงุตูู ุงูุชูููุฉ

### ุงููููุงุช ุงููุนุฏูุฉ:
- **`backend/src/controllers/storeController.ts`** (ุณุทูุฑ 324-353)
  - ุชุบููุฑ `productFiles: Express.Multer.File[]` ุฅูู `productFilesMap: Record<number, Express.Multer.File[]>`
  - ุงุณุชุฎุฑุงุฌ ุฑูู ุงูููุชุฌ ูู ุงุณู ุงูุญูู
  - ุญูุธ ูู ุตูุฑุฉ ูู ุงููููุน ุงูุตุญูุญ ุจุงูุฎุฑูุทุฉ

- **`backend/src/controllers/storeController.ts`** (ุณุทูุฑ 412-424)
  - ุฅุฒุงูุฉ `fileCursor` ู`slice` 
  - ุงููุตูู ุงููุจุงุดุฑ ุฅูู `productFilesMap[idx]`

### ุงููุญูุตุงุช:
- โ ุจูุงุก TypeScript: ูุฌุญ ุจุฏูู ุฃุฎุทุงุก
- โ ุจูุงุก Vite Frontend: ูุฌุญ ุจุฏูู ุฃุฎุทุงุก
- โ ูุง ุชูุฌุฏ ูุฑุงุฌุน ูุชุจููุฉ ูู `productFiles` ุงููุฏูู

---

## ๐งช ุงูุงุฎุชุจุงุฑ ุงูููุตู ุจู

### 1. ุฅูุดุงุก ูุชุฌุฑ ุฌุฏูุฏ ูุน ุนุฏุฉ ููุชุฌุงุช:
```bash
curl -X POST http://localhost:4000/api/store/create-with-images \
  -F "storeSlug=test-store" \
  -F "storeName=Test Store" \
  -F "storeId=123456" \
  -F 'products=[
    {"id":1,"name":"ููุชุฌ 1","price":100,...},
    {"id":2,"name":"ููุชุฌ 2","price":200,...},
    {"id":3,"name":"ููุชุฌ 3","price":300,...}
  ]' \
  -F "productImage_0=@path/to/product1-image1.jpg" \
  -F "productImage_0=@path/to/product1-image2.jpg" \
  -F "productImage_1=@path/to/product2-image1.jpg" \
  -F "productImage_2=@path/to/product3-image1.jpg" \
  -F "productImage_2=@path/to/product3-image2.jpg"
```

### 2. ุงูุชุญูู ูู ุงููุชูุฌุฉ:
- ุชููุฏ ูููุงุช `store.json` ูุชุฃูุฏ ูู ุฃู ูู ููุชุฌ ูุฏูู ุตูุฑู ุงูุตุญูุญ
- ุชุญูู ูู ุฃู ุงูุตูุฑ ูุฑุชุจุทุฉ ุจุงูููุชุฌ ุงูุตุญูุญ
- ุงุฎุชุจุฑ ุนุฑุถ ุงูููุชุฌุงุช ุนูู ุงููุงุฌูุฉ

---

## โ๏ธ ููุงุท ูููุฉ

1. **ุชุฑุชูุจ ุงูุญููู**: ูุฌุจ ุฃู ุชุชุทุงุจู ุฃุฑูุงู ุงูููุชุฌุงุช ูู ุฃุณูุงุก ุงูุญููู (`productImage_0`, `productImage_1`, ...) ูุน ุชุฑุชูุจ ุงูููุชุฌุงุช ูู ูุงุฆูุฉ ุงูููุชุฌุงุช

2. **ุญููู ูุชุนุฏุฏุฉ ูููุณ ุงูููุชุฌ**: ุฅุฐุง ุฃุฑุณู ุงูุนููู ุญููู ูุชุนุฏุฏุฉ ูููุณ ุงูููุชุฌ (ูุซู `productImage_0` ูุฑุชูู)ุ ุณุชูุถุงู ุฌููุน ุงูุตูุฑ ูููุณ ุงูููุชุฌ:
   ```typescript
   -F "productImage_0=@image1.jpg"
   -F "productImage_0=@image2.jpg"
   // ุณุชุคุฏู ุฅูู: productFilesMap[0] = [image1, image2]
   ```

3. **ุงูุนูุฏุฉ ููููู ุงูุงูุชุฑุงุถูุฉ**: ุฅุฐุง ูู ูุชู ุชุญููู ุตูุฑ ูููุชุฌ ูุนููุ ุณูุชู ุงุณุชุฎุฏุงู ุงูุตูุฑ ุงูุงูุชุฑุงุถูุฉ ุฃู ุงูุตูุฑ ุงููุฑุณูุฉ ูู ุจูุงูุงุช ุงูููุชุฌ ููุณู

---

## ๐ ูุฑุงุฌุน ุฅุถุงููุฉ

- **ุฏููู ุฅูุดุงุก ูุชุฌุฑ**: `STORE_CREATION_GUIDE.md`
- **ูุงุฆูุฉ ุงูุชุญูู**: `STORE_VERIFICATION_CHECKLIST.md`
- **ููุฏ ุงูุจูุงุก**: `backend/src/controllers/storeController.ts` (ุณุทูุฑ 276-559)

---

## โจ ุงููุชูุฌุฉ ุงูููุงุฆูุฉ

ูุน ูุฐุง ุงูุฅุตูุงุญ:
- โ **ูู ููุชุฌ ูุญุตู ุนูู ุตูุฑู ุงูุตุญูุญ**
- โ **ูุง ุชูุฌุฏ ูุฒูุฏ ูู ุญุงูุงุช ุงูุฎูุท**
- โ **ุงููุธุงู ุฃูุซุฑ ุงุณุชูุฑุงุฑุงู ูููุซูููุฉ**
- โ **ุณูู ุงูุตูุงูุฉ ูุงูุชุทููุฑ ูู ุงููุณุชูุจู**
